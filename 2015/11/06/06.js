"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),BASE_WIDTH=40,DRAW_SPEED=.5,CYCLES_PER_FRAME=3,WIDTH_DIM_SPEED=.01,MIN_BRANCH_LENGTH=120,MAX_BRANCH_LENGTH=360,MAX_BRANCHES_PER_SPLIT=4,TREE_COLOR={r:0,g:0,b:0},BACK_COLOR={r:255,g:255,b:255},TAU=2*Math.PI,BRANCH_MAX_ANGLE=TAU/7,canvas=document.getElementById("c"),context=canvas.getContext("2d"),generators=[],BranchGenerator=function(){function t(e){_classCallCheck(this,t),this.position={x:e.x,y:e.y},this.direction=e.a,this.width=e.w||BASE_WIDTH,this.life=0,this.length=Math.random()*(MAX_BRANCH_LENGTH-MIN_BRANCH_LENGTH)+MIN_BRANCH_LENGTH,this.level=e.l||1}return _createClass(t,[{key:"evolve",value:function(){this.position.x+=Math.cos(this.direction)*DRAW_SPEED,this.position.y+=Math.sin(this.direction)*DRAW_SPEED,this.life++,this.width-=WIDTH_DIM_SPEED*this.level}},{key:"getTangentPoint",value:function(t){return{x:this.position.x+Math.cos(t)*this.width/2,y:this.position.y+Math.sin(t)*this.width/2}}},{key:"draw",value:function(){var t=this.getTangentPoint(this.direction+TAU/4),e=this.getTangentPoint(this.direction-TAU/4);context.beginPath(),context.moveTo(t.x,t.y),context.lineTo(e.x,e.y),context.closePath(),context.stroke()}},{key:"split",value:function(){var e=Math.floor(Math.random()*MAX_BRANCHES_PER_SPLIT);0==e&&(e=1);for(var n=0,i=0;e>i;i++)n=BRANCH_MAX_ANGLE*i-Math.random()*BRANCH_MAX_ANGLE,generators.push(new t({x:this.position.x-Math.cos(this.direction)*this.width/3,y:this.position.y-Math.sin(this.direction)*this.width/3,a:this.direction+n,w:this.width,l:this.level+1}));generators.splice(generators.indexOf(this),1)}}]),t}(),cleanUp=function(){generators.forEach(function(t){t.width<=0&&generators.splice(generators.indexOf(t),1)})},addGenerator=function(t){generators.length||(context.fillStyle="rgba("+BACK_COLOR.r+","+BACK_COLOR.g+","+BACK_COLOR.b+",0.25)",context.fillRect(0,0,canvas.width,canvas.height)),context.fillStyle="rgb("+TREE_COLOR.r+","+TREE_COLOR.g+","+TREE_COLOR.b+")",generators.push(new BranchGenerator({x:t.x,y:canvas.height,a:-TAU/4}))},touch=function(e){var n=void 0,i=void 0,a=!0,o=!1,r=void 0;try{for(var s,c=e.touches[Symbol.iterator]();!(a=(s=c.next()).done);a=!0)t=s.value,n=t.clientX,i=t.clientY}catch(h){o=!0,r=h}finally{try{!a&&c["return"]&&c["return"]()}finally{if(o)throw r}}addGenerator({x:n,y:i})},click=function(t){console.log(t),addGenerator({x:t.clientX,y:t.clientY})},animate=function e(t){generators.forEach(function(t){for(var e=0;CYCLES_PER_FRAME>e;e++)t.draw(),t.evolve(),t.life>t.length&&t.split()}),cleanUp(),generators.length||addGenerator({x:Math.random()*canvas.width,y:canvas.height}),requestAnimationFrame(e)},resize=function(){canvas.width=window.innerWidth,canvas.height=window.innerHeight},init=function(){resize(),addGenerator({x:canvas.width/2,y:canvas.height}),animate()},reset=function(t){return t.stopPropagation(),context.clearRect(0,0,canvas.width,canvas.height),!1};document.addEventListener("touch",touch),document.addEventListener("click",click),window.addEventListener("resize",resize),document.addEventListener("DOMContentLoaded",init);